# 在庫操作の設計

## 在庫状態の変化パターン（優先度順）

### 最優先パターン
- **使い切り+新規開封**：開封済みを使い切って未開封を開封する（データ上は未開封-1のみ）
  - 実際の物理的な動き：「開封済み-1, 未開封-1, 開封済み+1」
  - データ上の変化：「未開封-1」（開封済み数は変化なし）
  - 最頻出のパターンで、専用ショートカットが必要

### 高頻度パターン
- **購入**：新しく購入した商品を追加（未開封+1）
- **単純使い切り**：開封済み品を使い切る（開封済み-1）
- **単純開封**：未開封品を開封する（未開封-1, 開封済み+1）

### 低頻度パターン（詳細調整パネルで対応）
- **未開封品の調整**：誤記録修正のための増減
- **開封済み品の調整**：誤記録修正のための増減
- **特殊ケース対応**：在庫ゼロからの購入など

## 基本的な変化カテゴリ

### 1. 未開封品に関する変化
- **増加パターン**：
  - 新規購入：未開封品が増える
  - 誤記録の修正：未開封数を増やす調整
  
- **減少パターン**：
  - 開封して使用開始：未開封品が減り、開封済み品が増える（**移行操作**）
  - 誤記録の修正：未開封数を減らす調整

### 2. 開封済み品に関する変化
- **増加パターン**：
  - 未開封品から移行：未開封品を開封（**移行操作**）
  - 誤記録の修正：開封済み数を増やす調整
  
- **減少パターン**：
  - 使い切り：開封済み品を消費完了
  - 誤記録の修正：開封済み数を減らす調整

## ユーザーフロー

### 基本的な使用パターン
1. ユーザーがアイテムリストでアイテムを見つける
2. アイテムカードを左にスワイプして操作パネルを表示または右スワイプで最頻出操作を実行
3. 適切な操作ボタンをタップ
4. 確認が必要な場合は確認ダイアログを表示
5. 操作完了後、視覚的フィードバックを表示

### 頻繁に行われる操作
- **使い切り+開封（最頻出）**：
  1. アイテムカードを右スワイプ（またはパネル内の専用ボタンをタップ）
  2. 未開封数が減少し、視覚的フィードバック表示

- **購入**：
  1. アイテムカードを左スワイプ
  2. 「購入」ボタンをタップ
  3. 未開封数が増加し、視覚的フィードバック表示

- **単純使い切り**：
  1. アイテムカードを左スワイプ
  2. 「使い切り」ボタンをタップ
  3. 開封済み数が減少し、視覚的フィードバック表示

- **単純開封**：
  1. アイテムカードを左スワイプ
  2. 「開封」ボタンをタップ
  3. 未開封数が減少、開封済み数が増加

## テスト観点での考慮事項

### 機能テスト
- 各操作ボタンが正しく状態を変更するか
- 複合操作が一貫して処理されるか
- 在庫数が境界値（0など）の場合の挙動

### UI/UXテスト
- スワイプ操作の感度と操作性
- 操作パネルの視認性とタップターゲットの大きさ
- 操作フィードバックの明瞭さ

### 状態管理テスト
- 操作後の状態が永続化されるか
- アプリ再起動後も状態が維持されるか
- 複数操作の同時性処理

## UI設計仕様

### スワイプ操作
- 左スワイプ：操作パネル表示
- 右スワイプ：最頻出操作「使い切り+開封」のクイック実行

### 操作パネル（優先度順）
- 「使い切り+開封」ボタン：未開封-1（最優先・目立たせる）
- 「購入」ボタン：未開封+1
- 「開封」ボタン：未開封-1、開封+1
- 「使い切り」ボタン：開封-1
- 「詳細調整」ボタン：数量調整モーダル表示

### 数量調整モーダル（低頻度操作用）
- 未開封/開封済みの現在数表示
- 増減ボタンと直接数値入力欄
- 変更理由の選択（オプション）