# 在庫操作の設計

## 在庫状態の変化パターン

### 1. 未開封品に関する変化
- **増加パターン**：
  - 新規購入：未開封品が増える
  - 誤記録の修正：未開封数を増やす調整
  
- **減少パターン**：
  - 開封して使用開始：未開封品が減り、開封済み品が増える（**移行操作**）
  - 誤記録の修正：未開封数を減らす調整

### 2. 開封済み品に関する変化
- **増加パターン**：
  - 未開封品から移行：未開封品を開封（**移行操作**）
  - 誤記録の修正：開封済み数を増やす調整
  
- **減少パターン**：
  - 使い切り：開封済み品を消費完了
  - 誤記録の修正：開封済み数を減らす調整

### 3. 複合的な変化
- **開封と消費の連続操作**：
  - 未開封品を開封して一部使用後保管（未開封-1、開封+1）
  - 未開封品を開封して全て使い切る（未開封-1のみ）
  - 開封済み品を使い切り、同時に未開封品を開封（開封-1、未開封-1、開封+1）
  
- **複数個の同時操作**：
  - 複数の未開封品をまとめて開封
  - 複数の開封済み品をまとめて使い切る
  - 複数の未開封品をまとめて購入

### 4. 特殊なケース
- **在庫ゼロからの操作**：
  - 新規アイテム登録（初期在庫設定）
  - 在庫切れ後の再購入
  
- **アイテム情報の変更**：
  - 商品名、ブランド、カテゴリ等の修正
  - 閾値の変更
  - 購入URLの更新/追加

## ユーザーフロー

### 基本的な使用パターン
1. ユーザーがアイテムリストでアイテムを見つける
2. アイテムカードを左にスワイプして操作パネルを表示
3. 適切な操作ボタンをタップ
4. 確認が必要な場合は確認ダイアログを表示
5. 操作完了後、視覚的フィードバックを表示

### 頻繁に行われる操作
- **開封済み品の使い切り**：
  1. アイテムカードを左スワイプ
  2. 「使い切り」ボタンをタップ
  3. 開封済み数が減少し、視覚的フィードバック表示

- **未開封品の開封**：
  1. アイテムカードを左スワイプ
  2. 「開封」ボタンをタップ
  3. 未開封数が減少、開封済み数が増加

## テスト観点での考慮事項

### 機能テスト
- 各操作ボタンが正しく状態を変更するか
- 複合操作が一貫して処理されるか
- 在庫数が境界値（0など）の場合の挙動

### UI/UXテスト
- スワイプ操作の感度と操作性
- 操作パネルの視認性とタップターゲットの大きさ
- 操作フィードバックの明瞭さ

### 状態管理テスト
- 操作後の状態が永続化されるか
- アプリ再起動後も状態が維持されるか
- 複数操作の同時性処理

## UI設計仕様

### スワイプ操作
- 左スワイプ：操作パネル表示
- 右スワイプ：最もよく使う操作のクイック実行（設定可能）

### 操作パネル
- 「購入」ボタン：未開封+1
- 「開封」ボタン：未開封-1、開封+1
- 「使い切り」ボタン：開封-1
- 「詳細調整」ボタン：数量調整モーダル表示

### 数量調整モーダル
- 未開封/開封済みの現在数表示
- 増減ボタンと直接数値入力欄
- 変更理由の選択（オプション）