# Re-Stock アプリ アクティブコンテキスト

## 現在の作業の焦点

現在、Re-Stock アプリの機能拡張フェーズにあり、以下の作業に焦点を当てています：

**最優先タスク: LINE Mini App / LIFF統合**
- LINE LIFFを使用したWeb App化
- LINE ログイン連携
- LINE内シェア機能の実装
- LINE特有の体験最適化

1. **プロジェクト構造の確立**

   - ✅ ディレクトリ構造の設計と実装
   - ✅ 基本的なファイル構成の作成
   - ✅ 開発環境の構築

2. **ドメインモデルの設計と実装**

   - ✅ エンティティと値オブジェクトの定義
   - ✅ ドメインサービスの特定と実装
   - ⬜ リポジトリインターフェースの設計と実装
   - ⬜ 詳細なバリデーションロジックの実装

3. **UI コンポーネントの実装**

   - ✅ 基本的な UI コンポーネントの実装（Badge, Button）
   - ✅ 機能コンポーネントの実装（Header, NavigationBar, CategoryCard, ItemCard）
   - ✅ メインアプリケーションコンポーネントの実装（InventoryApp）
   - ✅ 在庫操作UI（SwipeableItemCard, ItemOperationPanel）の実装
   - ⬜ アイテム追加/編集フォームの実装
   - ⬜ 詳細ページの実装

4. **状態管理の実装**
   - ✅ Zustand ストアの設計と実装
   - ✅ アイテムストアの実装
   - ✅ カテゴリ表示のための派生データ実装
   - ✅ localStorage との連携
   - ✅ 状態更新ロジックの実装
   - ⬜ フィルタリング機能の強化

5. **LINE Mini App / LIFF統合**
   - ✅ LINE LIFF SDKの追加と初期化
   - ✅ LINE ログイン機能の実装
   - ✅ ユーザープロフィール取得機能
   - ✅ LINE共有機能の基本実装
   - ⬜ 404エラー解決
   - ⬜ サーバーサイドコンポーネント対応
   - ⬜ 環境変数設定の改善

## 最近の変更

以下の作業が完了しています：

1. **プロジェクト初期化と設定**

   - ✅ Next.js プロジェクトの作成
   - ✅ TypeScript の設定
   - ✅ ESLint と Prettier の設定
   - ✅ Tailwind CSS の設定

2. **依存関係の追加**

   - ✅ コア依存関係のインストール
   - ✅ 開発依存関係のインストール
   - ✅ Zustand, lucide-react, class-variance-authority, clsx, tailwind-merge のインストール
   - ✅ LINE LIFF SDK追加

3. **ドメインモデルの実装**

   - ✅ ブランド型を使用した型安全な値オブジェクト（ItemId, ItemName, CategoryName, BrandName）
   - ✅ エンティティ（Item）の定義
   - ✅ ドメインサービス（isItemLowStock, getLowStockItems）の実装

4. **状態管理の実装**

   - ✅ Zustand ストアの実装（useItemStore）
   - ✅ localStorage を使用した永続化
   - ✅ サンプルデータの初期化
   - ✅ 在庫操作のためのアクション実装
   - ✅ LINE認証状態のストア実装

5. **UI コンポーネントの実装**

   - ✅ 基本 UI コンポーネント（Badge, Button）の実装
   - ✅ ヘッダーとナビゲーションバーの実装
   - ✅ カテゴリカードの実装
   - ✅ アイテムカードの実装
   - ✅ スワイプ可能なアイテムカードの実装
   - ✅ アイテム操作パネルの実装
   - ✅ メインアプリケーションコンポーネントの実装
   - ✅ LINE特化コンポーネントの実装

6. **LINE Mini App / LIFF統合**
   - ✅ LIFF SDK初期化実装
   - ✅ LINE認証フロー実装
   - ✅ LINE共有機能実装
   - ✅ 環境変数設定

## 次のステップ

短期的には、以下のタスクに取り組む予定です（優先順位順）：

1. **LINE Mini App / LIFF統合の完成** (最優先)
   - 404エラーのデバッグと解決
   - 認証フローの完全テスト
   - サーバーサイドコンポーネントの実装
   - 環境変数の適切な設定

2. **アイテム追加/編集フォームの実装**

   - モーダルまたは専用ページとしての実装
   - フォームバリデーションの実装
   - 画像アップロード機能の検討

3. **カテゴリフィルターの実装**

   - カテゴリ別表示切り替え
   - 検索機能

4. **リポジトリの完全実装**

   - リポジトリインターフェースの完全実装
   - LocalStorageItemRepository の完全実装
   - InMemoryItemRepository の実装（テスト用）

5. **バリデーションの強化**

   - 入力値の詳細なバリデーション
   - エラーメッセージの国際化対応
   - フォームバリデーションの実装

6. **テストの実装**
   - ドメインモデルのユニットテスト
   - リポジトリのユニットテスト
   - UI コンポーネントのテスト
   - 統合テスト

## アクティブな決定事項と考慮事項

### 決定済み事項

1. **アーキテクチャ**

   - クリーンアーキテクチャとドメイン駆動設計の採用
   - レイヤー間の依存関係の方向性

2. **技術スタック**

   - Next.js (App Router) の採用
   - TypeScript の採用
   - Tailwind CSS の採用
   - Zustand の採用
   - localStorage の採用（初期実装）
   - LINE LIFF SDK 2.23.0の採用

3. **UI デザイン**

   - モバイルファーストのレイアウト
   - カテゴリごとの商品表示
   - 未開封品と開封済み品の視覚的な区別（緑と黄色の丸）
   - 在庫が閾値以下の商品に警告バッジ表示
   - 在庫操作UIはスワイプ方式を採用し、よく使う操作パターンをショートカットとして提供
   - 最優先パターンは「使い切り+開封」（開封済みを使い切り未開封を開封）の複合操作
   - 操作パターンは頻度に基づいて優先順位付け（「使い切り+開封」「購入」「使い切り」「開封」）
   - UI設計は日常的な使用パターンに合致するよう最適化
   - LINE特有のUIガイドラインに従ったデザイン調整

4. **開発プロセス**
   - GitHub Flow に基づくブランチ戦略
   - 意味のある単位でのコミット
   - 機能ごとの優先順位付け

### 検討中の事項

1. **LINE統合の詳細設計**

   - LIFFアプリのURL構造最適化
   - LINE Browser環境での動作最適化
   - サーバーサイド処理の必要性

2. **データモデルの詳細設計**

   - カテゴリの事前定義 vs. ユーザー定義
   - アイテムの追加属性（例：サイズ、色、購入日など）
   - 複数の購入 URL の対応

3. **UI/UX の詳細設計**

   - ダークモード対応
   - アクセシビリティ対応
   - アニメーションの追加

4. **将来的な拡張**
   - バックエンド統合の方法
   - ユーザー認証の実装
   - データ同期の方法

## 現在の課題

1. **技術的な課題**

   - LIFF URL構造と404エラー
   - LINE Browser環境での互換性
   - Tailwind CSS v4 との互換性（@apply ディレクティブの変更など）
   - サーバーコンポーネントと Zustand の連携（"use client" ディレクティブの必要性）
   - localStorage の容量制限への対応

2. **ビジネス的な課題**
   - ユーザーニーズの優先順位付け
   - MVP（最小実行可能製品）の範囲の決定
   - フィードバックの収集方法

## 進行中のタスク

- LINE Mini App / LIFF統合のバグ修正
- LINE特化機能の拡張
- UI コンポーネントの拡張
- バリデーションロジックの強化

## 今後の検討事項

- LINE環境でのユーザーテスト計画
- デプロイ戦略の検討
- パフォーマンスモニタリングの導入
- アナリティクスの導入